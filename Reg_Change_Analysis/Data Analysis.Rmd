---
title: "Data Analysis - Service Provisions by Movement Organizations within within Regime Change Movements"
output: html_document
---

```{r}
#Packages
require(dplyr)

#Data
data <- read.csv("Data/NAVCO_2.0.csv")

#looking only at regime change movements
regchange <- data %>% filter(camp_goals==0)

#total number of observations
nrow(regchange) 
#total number of movements
regchange %>% select(campaign) %>% unique %>% nrow
#sample of the data
regchange %>% select(year:target,camp_orgs) %>% head(7)
```

Here I need to make a variable counting the total number of operative organizations during a given campaign-country-year. Using the `camp_orgs` variable, which is a measure that captures the number of **_new_** organizations entering a campaign for a given year.

Specifically from the codebook:
> Number of new named organizations involved in the campaign in that particular year.
0-10=number of new named campaign organizations in a particular year 11=more than 10 new named organizations -99=unknown

Assuming the 0 for a starting year == 1 organization, since presumably at least one organization would need to be in operation for the movement to proceed. I will start the count at one, unless otherwise noted. 

Creating the count variable
```{r}
#List of all the campaigns
camp <- as.character(regchange$campaign) %>% unique
output <- NULL 
for(j in 1:length(camp)){
  temp <- regchange %>% filter(campaign==camp[j])
  for(i in 1:nrow(temp)){
    if(i==1){
      if(!is.na(temp$camp_orgs[1])){
        temp$count[1] <- ifelse(temp$camp_orgs[1]>0,temp$camp_orgs[1],1)
        } else{
          temp$count[1] <- 1
          }
      } else { if(is.na(temp$camp_orgs[i])){
        temp$count[i] <- temp$count[i-1] + 0
        } else { 
          temp$count[i] <- temp$count[i-1] + temp$camp_orgs[i]
          }
        }
    }
  output <- rbind(output,temp)
  temp$count <- NA
  }
#See if everying worked
output %>% select(year:target,camp_orgs,count) %>% View
summary(output$count) #too large
hist(output$count,breaks = 20,col="grey") #right skew
#transformation
hist(log(output$count),breaks = 20,col="lightblue")
hist(sqrt(output$count),breaks = 20,col="lightblue")
```

For now, the variable looks right (there are a few underlying theoretical issues that I will have to consider).

Let's run some preliminary analysis:
```{r}
require(descr)
crosstab(output$pi_socwel,output$count)
#LPM
lm(output$pi_socwel~output$count) %>% summary
#probit
glm(output$pi_socwel~output$count,family = binomial("probit")) %>% summary
#more sophistocated model
glm(pi_socwel~count+camp_structure+camp_support+camp_size+repression,data=output,family = binomial("probit")) %>% summary

#Model with the transformed var
lm(output$pi_socwel~log(output$count)) %>% summary
glm(output$pi_socwel~log(output$count),family = binomial("probit")) %>% summary
glm(pi_socwel~log(count)+camp_structure+camp_support+camp_size+repression,data=output,family = binomial("probit")) %>% summary
```
Nothing...